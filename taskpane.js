/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";var e={25803:function(e,t,n){e.exports=n.p+"dec1cd614b9ef6fe2b47.js"},58394:function(e,t,n){e.exports=n.p+"d949a5e4a783941f8745.css"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.m=e,n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=o[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(e){if("string"==typeof e)return n(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function o(){o=function(){return n};var t,n={},r=Object.prototype,a=r.hasOwnProperty,c=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",d=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(t){u=function(e,t,n){return e[t]=n}}function p(e,t,n,o){var r=t&&t.prototype instanceof b?t:b,a=Object.create(r.prototype),i=new j(o||[]);return c(a,"_invoke",{value:L(e,n,i)}),a}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var g="suspendedStart",f="suspendedYield",v="executing",y="completed",h={};function b(){}function x(){}function E(){}var w={};u(w,s,(function(){return this}));var I=Object.getPrototypeOf,S=I&&I(I(_([])));S&&S!==r&&a.call(S,s)&&(w=S);var T=E.prototype=b.prototype=Object.create(w);function B(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(t,n){function o(r,c,i,s){var l=m(t[r],t,c);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==e(u)&&a.call(u,"__await")?n.resolve(u.__await).then((function(e){o("next",e,i,s)}),(function(e){o("throw",e,i,s)})):n.resolve(u).then((function(e){d.value=e,i(d)}),(function(e){return o("throw",e,i,s)}))}s(l.arg)}var r;c(this,"_invoke",{value:function(e,t){function a(){return new n((function(n,r){o(e,t,n,r)}))}return r=r?r.then(a,a):a()}})}function L(e,n,o){var r=g;return function(a,c){if(r===v)throw Error("Generator is already running");if(r===y){if("throw"===a)throw c;return{value:t,done:!0}}for(o.method=a,o.arg=c;;){var i=o.delegate;if(i){var s=O(i,o);if(s){if(s===h)continue;return s}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(r===g)throw r=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r=v;var l=m(e,n,o);if("normal"===l.type){if(r=o.done?y:f,l.arg===h)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(r=y,o.method="throw",o.arg=l.arg)}}}function O(e,n){var o=n.method,r=e.iterator[o];if(r===t)return n.delegate=null,"throw"===o&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),h;var a=m(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,h;var c=a.arg;return c?c.done?(n[e.resultName]=c.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function _(n){if(n||""===n){var o=n[s];if(o)return o.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,c=function e(){for(;++r<n.length;)if(a.call(n,r))return e.value=n[r],e.done=!1,e;return e.value=t,e.done=!0,e};return c.next=c}}throw new TypeError(e(n)+" is not iterable")}return x.prototype=E,c(T,"constructor",{value:E,configurable:!0}),c(E,"constructor",{value:x,configurable:!0}),x.displayName=u(E,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,u(e,d,"GeneratorFunction")),e.prototype=Object.create(T),e},n.awrap=function(e){return{__await:e}},B(k.prototype),u(k.prototype,l,(function(){return this})),n.AsyncIterator=k,n.async=function(e,t,o,r,a){void 0===a&&(a=Promise);var c=new k(p(e,t,o,r),a);return n.isGeneratorFunction(t)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},B(T),u(T,d,"Generator"),u(T,s,(function(){return this})),u(T,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},n.values=_,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(o,r){return i.type="throw",i.arg=e,n.next=o,r&&(n.method="next",n.arg=t),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var c=this.tryEntries[r],i=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var s=a.call(c,"catchLoc"),l=a.call(c,"finallyLoc");if(s&&l){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var c=r?r.completion:{};return c.type=e,c.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;C(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,o){return this.delegate={iterator:_(e),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=t),h}},n}function r(e,t,n,o,r,a,c){try{var i=e[a](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(o,r)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var c=e.apply(t,n);function i(e){r(c,o,a,i,s,"next",e)}function s(e){r(c,o,a,i,s,"throw",e)}i(void 0)}))}}function c(){return c=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Word.run(function(){var e=a(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("authTokenMia"),$(document).on("click",".switch-container",(function(e){e.stopPropagation()})),$(document).on("click",".icon-refresh-revisa",(function(e){e.stopPropagation()})),$(document).on("click",".collapser",(function(e){var t=$(this),n=t.closest(".collapse"),o=t.closest(".menu-group");n.length>0?n.find(".collapser").not(t).removeClass("open").addClass("collapsed").next(".collapse").collapse("hide"):(o.find(".collapser").not(t).removeClass("open").addClass("collapsed").next(".collapse").collapse("hide"),console.log("entro en el else")),t.toggleClass("collapsed open"),t.next(".collapse").collapse("toggle"),e.stopPropagation()})),n?(k(),l()):(H(),document.getElementById("auth-token").style.display="block",document.getElementById("bg-color").style.display="flex"),e.next=5,t.sync();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function i(e){var t;try{t=JSON.parse(e.replace(/&quot;/g,'"'))}catch(n){t=e}var n=window.screen.width/2-300,o=window.screen.height/2-250,r=window.open("https://victorwake.github.io/MiaWord/postMessage.html","PopupWindow","width=".concat(600,",height=").concat(500,",left=").concat(n,",top=").concat(o,",toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no"));window.addEventListener("message",(function(e){"ready"===e.data&&r&&r.postMessage({alternatives:t},"*")}))}function s(e){try{"string"==typeof e&&(e=JSON.parse(e))}catch(e){return void console.error("Error al parsear dataCode:",e.message)}if(Array.isArray(e)&&!(e.length<2)){var t=e[0],n=e[1];return console.log("Mensaje 1:",t),console.log("Mensaje 2:",n),new Promise((function(e,n){Office.context.ui.displayDialogAsync("https://victorwake.github.io/MiaWord/tuDialogo.html",{height:50,width:50,displayInIframe:!0},(function(o){if(o.status===Office.AsyncResultStatus.Failed)console.error("Error al abrir el diálogo:",o.error.message),n(o.error);else{console.log("Diálogo abierto exitosamente.");var r=o.value;setTimeout((function(){r.messageChild(t),console.log("Mensaje enviado al diálogo:",t)}),2e3),r.addEventHandler(Office.EventType.DialogMessageReceived,(function(t){console.log("Mensaje recibido del diálogo:",t.message),"cerrar"===t.message?(console.log("Cerrando el diálogo..."),r.close(),e("Diálogo cerrado por el diálogo.")):console.log("Mensaje no reconocido:",t.message)}))}}))}))}console.error("El parámetro dataCode debe ser un arreglo con al menos dos mensajes.")}function l(){var e=A();$.ajax({url:"https://miadev.miaintelligence.com:444/api/getDoclangDoccountryFromDocument",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer ".concat(e)},data:JSON.stringify({documentPath:null,documentText:"Doc",onlyCountries:null}),success:function(t){t&&(function(e){if(q(),e)return U(),R(),H(),J(),document.getElementById("classify-document").style.display="block",null!==localStorage.getItem("authTokenMia");R(),H(),console.log("Token is not available.")}(e),y(),console.log("sessionActiveToken: OK"))},error:function(e,t,n){console.log("Error:",n),console.log("Status:",t),console.log("Response Text:",e.responseText),console.log("Ready State:",e.readyState),console.log("HTTP Status Code:",e.status);try{401===e.status&&(console.log("entro sessionActiveToken 401"),D())}catch(e){console.log("Error al parsear JSON de la respuesta:",e)}}})}function d(e,t,n,o){var r=A(),a={documentPath:null,documentText:o,onlyCountries:[]};console.log("lo que le envio idioma del doc y pais: ",JSON.stringify(a)),$.ajax({url:"https://miadev.miaintelligence.com:444/api/getDoclangDoccountryFromDocument",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer ".concat(r)},data:JSON.stringify(a),success:function(r){!function(e,t,n,o,r){for(var a=A(),c=[],i=0;i<e.length;i+=2)c.push({normative_reference:e[i]||"",threat:e[i+1]||""});var s=r&&r.es||"es",l=r&&r.country||"España",d=document.getElementById("tipo-doc-select"),p=document.getElementById("materia-select"),m={doc:o,scope:"nacional",doclang:s,doctype:(null==d?void 0:d.value)||null,subject:(null==p?void 0:p.value)||null,criteria:[{code:t.dataCode,normative_refs:c,integrity_hash:t.integrityHash,weight:t.weight,description:t.description,exclude:t.exclude,title:o,content:o}],documentPath:null,country:l};console.log("lo que le envio a qualifyGenerative: ",JSON.stringify(m)),$.ajax({url:"https://miadev.miaintelligence.com:444/api/qualifyGenerative",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer ".concat(a)},data:JSON.stringify(m),success:function(e){console.log("idioma del doc y pais: ",JSON.stringify(e)),u(n,"remove"),function(e,t){var n,o,r,a,c=null===(n=e.data.data[0])||void 0===n?void 0:n.evaluation,i=null===(o=e.data.data[0])||void 0===o?void 0:o.explanation,s=(null===(r=e.data.data[0])||void 0===r?void 0:r.alternatives)||[];a="ko"===c?"NO CUMPLE":"ok"===c?"CUMPLE":"EVALUACIÓN DESCONOCIDA";var l=' \n    <div class="!pt-4 ng-star-inserted mt-3">\n      <span class="!font-semibold leading-6"> \n        RESULTADO:\n        <span id="color-inserted" class="'.concat("ko"===c?"text-red":"text-green",'">').concat(a,'</span>\n      </span>\n      <br>\n      <span class="span-sub-content mt-3">\n      ').concat(i,"\n      </span>\n    </div>"),d=document.getElementById(t);if(d){var u=d.parentElement.querySelector(".btn-revisa.correct");u?(u.classList.add("correct-act","cursor-pointer"),u.setAttribute("data-code",JSON.stringify(s)),console.log("Clases y data-code agregados:",u)):console.error("No se encontró el elemento con la clase 'correct'");var p=d.closest(".card");if(p){var m=d.closest("div");m?m.insertAdjacentHTML("beforebegin",l):console.error("No se encontró un div padre del botón.");var g=p.querySelector(".rec-box");if(g){g.classList.remove("rec-red","rec-green","rec-grey"),g.classList.add("ko"===c?"rec-red":"ok"===c?"rec-green":"rec-grey");var f=g.querySelector(".icon");f?(f.className="icon","ok"===c?f.classList.add("icon-check"):"ko"===c&&f.classList.add("icon-x")):console.error("No se encontró un <span> con la clase 'icon' dentro de rec-box.")}else console.error("No se encontró un elemento con la clase 'rec-box' dentro del card.")}else console.error("No se encontró el div padre con clase 'card' para el botón con ID:",t)}else console.error("No se encontró un botón con ID:",t)}(e,n)},error:function(e,t,n){var o;console.log("Estado del error: ",t),console.log("Estado del error: ",n),401===e.status?(o=e.responseJSON.message,D()):o="Error del servidor.",console.log({message:o})},complete:function(){}})}(e,t,n,o,r)},error:function(e,t,n){var o;console.log("Estado del error: ",t),console.log("Estado del error: ",n),401===e.status?(o=e.responseJSON.message,D()):o="Error del servidor.",console.log({message:o})},complete:function(){}})}function u(e,t){var n,o=null===(n=document.getElementById(e))||void 0===n?void 0:n.closest(".card-body.sub.px-3");if(o){var r=o.querySelector(".icon.icon-refresh.icon-white");r?"add"===t?r.classList.add("rotate-icon-refresh"):"remove"===t?r.classList.remove("rotate-icon-refresh"):console.log("Acción no válida:",t):console.log("No se encontró un ícono con la clase 'icon icon-refresh icon-white' dentro del contenedor.")}else console.log("No se encontró el contenedor para el ID:",e)}function p(e){var t=A(),n={doc:e};$.ajax({url:"https://miadev.miaintelligence.com:444/api/classifyGenerative",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer ".concat(t)},data:JSON.stringify(n),success:function(e){console.log("Clasificacion automatica: ",JSON.stringify(e)),function(e){var t=document.getElementById("doctype");e&&e.message?(f(),t.innerText=e.message):e&&e.doctype?(f(),t.innerText=e.doctype,function(e){for(var t=document.getElementById("materia-select"),n=document.getElementById("tipo-doc-select"),o=0;o<t.options.length;o++)if(t.options[o].value===e.subject_code){t.selectedIndex=o;break}var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1),t.dispatchEvent(r);for(var a=!1,c=0;c<n.options.length;c++)if(n.options[c].value===e.code){n.selectedIndex=c,a=!0;break}if(!a){var i=document.createElement("option");i.value="sin_clasificar",i.text="sin clasificar",n.appendChild(i),n.selectedIndex=n.options.length-1}w()}(e)):(f(),t.innerText="No response from server.")}(e.data)},error:function(e,t,n){var o;G(),S(),console.log("Estado del error: ",t),console.log("Estado del error: ",n),401===e.status?(o=e.responseJSON.message,D()):o="Error del servidor.",_({message:o})},complete:function(){}})}function m(){Word.run(function(){var e=a(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(),g(),n=t.document,(r=n.body).load("text"),e.next=7,t.sync();case 7:p(r.text.trim()||"doc vacio");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function g(){var e=document.getElementById("spin"),t=document.getElementById("sping-refresh");e&&e.classList.add("icon-refresh-2","w-600","spin-animation"),t&&t.classList.add("spin-animation")}function f(){var e=document.getElementById("spin"),t=document.getElementById("sping-refresh");e&&e.classList.remove("icon-refresh-2","w-600","spin-animation"),t&&t.classList.remove("spin-animation")}function v(){var e=document.getElementById("doctype");e&&(e.innerText="")}function y(){var e=A();$.ajax({url:"https://miadev.miaintelligence.com:444/api/getGenerativeClassifierConfig",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer ".concat(e)},data:JSON.stringify({lang:"es"}),success:function(e){e&&e.data&&(function(e){!function(e){var n,o,r=document.getElementById("materia-select");r.innerHTML="";for(var a=0,c=Object.entries(e);a<c.length;a++){var i=(n=c[a],o=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,c,i=[],s=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=a.call(n)).done)&&(i.push(o.value),i.length!==t);s=!0);}catch(e){l=!0,r=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return i}}(n,o)||t(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=i[0],l=i[1],d=document.createElement("option");d.value=l,d.textContent=s,r.appendChild(d)}}(e.subject_codes);var n=document.getElementById("materia-select").value;n&&h(e.default_config[n]);var o={penal:"penal",privacidad:"PRIVACIDAD",sin_clasificar:"sin clasificar prueba"};document.getElementById("materia-select").addEventListener("change",(function(){var t=this.value,n=o[t];n?e.default_config[n]?h(e.default_config[n]):console.log("La clave no existe en el JSON:",n):console.log("No se encontró mapeo para el valor seleccionado:",t)}))}(e.data),m(),setTimeout((function(){w()}),6e3))},error:function(e,t,n){console.log("Error:",n),console.log("Status:",t),console.log("Response Text:",e.responseText),console.log("Ready State:",e.readyState),console.log("HTTP Status Code:",e.status);try{401===e.status&&(D(),console.log("entro unauthorizedToken"))}catch(e){console.log("Error al parsear JSON de la respuesta:",e)}}})}function h(e){var t=document.getElementById("tipo-doc-select"),n=document.getElementById("doctype");t.innerHTML="",e&&e.forEach((function(e){var n=document.createElement("option");n.value=e.code,n.textContent=e.doctype,n.dataset.doctype=e.doctype,t.appendChild(n)})),t.addEventListener("change",(function(){var e=t.options[t.selectedIndex];n.textContent=e.dataset.doctype||""})),t.options.length>0&&setTimeout((function(){n.textContent=t.options[t.selectedIndex].dataset.doctype}),2e3),N()}function b(){var e=document.querySelector(".icon-chevron-right"),t=document.getElementById("classify-document-body");e.classList.toggle("rotated"),"350px"===t.style.height?t.style.height="0":t.style.height="350px"}function x(){var e=document.getElementById("chat-input"),t=e.value.trim();if(t){var n=document.getElementById("chat-box"),o=document.createElement("div");o.classList.add("message","user-message"),o.textContent=t,n.appendChild(o),e.value="",B(),w().then((function(e){E(t,e)}))}}function E(e,t){console.log("texto que le llega a sendTextToServer: "+e),new Promise((function(e,t){Word.run(function(){var n=a(o().mark((function n(r){var a;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,(a=r.document.body).load("text"),n.next=5,r.sync();case 5:e(a.text),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),t("Error al obtener el texto del documento: "+n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}())})).then((function(n){var o,r,a=A();document.getElementById("response-text").innerText="",document.getElementById("loadingMessageEnv").style.display="block",o=document.getElementById("chat-box"),(r=document.createElement("div")).classList.add("message","bot-message","typing-indicator"),r.innerHTML='\n    <div class="typing typing-1"></div>\n    <div class="typing typing-2"></div>\n    <div class="typing typing-3"></div>\n  ',o.appendChild(r),B();var c=localStorage.getItem("conversation_id")||null,i={question:e,conversation_id:c,actions:!1,lang:"es",data:null,raw_text:n,meta:{doclang:"es",generativeClassification:{doctype:t.generativeClassification.doctype,subject_code:t.generativeClassification.subject_code,code:t.generativeClassification.code,subject:t.generativeClassification.subject},doccountry:"España"},country:"España",expertMode:!1};console.log("Payload enviado:",JSON.stringify(i)),$.ajax({url:"https://miadev.miaintelligence.com:444/api/callDocChat",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer ".concat(a)},data:JSON.stringify(i),success:function(e){G(),S(),console.log("Payload recibido:",JSON.stringify(e)),I(e)},error:function(e,t,n){var o;G(),S(),console.log("Estado del error: ",t),console.log("Estado del error: ",n),401===e.status?(I(JSON.stringify({data:{messages:[{role:"assistant",content:"La sesión ha caducado."}],conversation_id:"session_expired"}})),setTimeout((function(){D()}),3e3)):o="Error del servidor.",_({message:o})},complete:function(){G()}})})).catch((function(e){console.error(e),_({message:e})}))}function w(){return new Promise((function(e){var t=document.getElementById("materia-select"),n=document.getElementById("tipo-doc-select"),o=document.getElementById("doctype"),r=t.value,a=r,c=n.value;a&&("privacidad"===a&&(a="PRIVACIDAD"),"sin_clasificar"===a&&(a="sin clasificar prueba"));var i={generativeClassification:{doctype:o.textContent,subject_code:r,code:c,subject:a}};console.log(JSON.stringify(i)),console.log("materia: "+r+" Tipo Doc.: "+c+" span: "+o.textContent),e(i)}))}function I(e){var t=document.getElementById("chat-box");if(S(),"string"==typeof e)try{e=JSON.parse(e)}catch(e){return void T("Respuesta del servidor no es un JSON válido.")}if(e&&e.data&&e.data.messages){e.data.conversation_id&&localStorage.setItem("conversation_id",e.data.conversation_id);var n=e.data.messages.reverse().find((function(e){return"assistant"===e.role}));if(n&&n.content){var o=document.createElement("div");o.classList.add("message","bot-message"),o.textContent=n.content,t.appendChild(o),B()}else T("No hay contenido en el mensaje del asistente.")}else T("No response from server.")}function S(){var e=document.querySelector(".typing-indicator");e&&e.remove()}function T(e){var t=document.getElementById("chat-box"),n=document.createElement("div");n.classList.add("message","bot-message"),n.textContent=e,t.appendChild(n),B()}function B(){var e=document.getElementById("chat-box");e.scrollTop=e.scrollHeight}function k(){var e=document.getElementById("chat-box");localStorage.removeItem("conversation_id"),e.innerHTML=""}function L(){Word.run(function(){var e=a(o().mark((function e(t){var n,r,a,c,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document,(r=n.getSelection()).load("text"),(a=t.document.body).load("text"),e.next=7,t.sync();case 7:if(c=r.text.trim(),i=!1,0===c.length&&(c=a.text.trim(),i=!0),0!==c.length){e.next=13;break}return _({message:"El documento está vacío o no hay selección."}),e.abrupt("return");case 13:w().then((function(e){e&&e.generativeClassification?O(c,e,i):_({message:"No se encontraron datos adicionales para enviar junto con el texto."})})).catch((function(e){console.error("Error al obtener docData:",e),_({message:"Error al procesar los datos del documento."})}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function O(e,t,n){var o=document.getElementById("chat-box"),r=document.createElement("div");r.classList.add("message","user-message"),r.textContent=n?"Doc.":e,o.appendChild(r),B(),E(e,t)}function N(){var e,t;e=document.getElementById("qualifier-groups"),t=document.getElementById("qualifier_custom_groups"),e&&(e.innerHTML=""),t&&(t.innerHTML=""),C("add");var n=A(),o=document.getElementById("tipo-doc-select").value;console.log("Texto del select: "+o);var r={doctype_code:o,country:"España",lang:"es"};console.log("Payload enviado:",JSON.stringify(r)),$.ajax({url:"https://miadev.miaintelligence.com:444/api/getMatchGroups",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer ".concat(n)},data:JSON.stringify(r),success:function(e){console.log("Match Groups: ",JSON.stringify(e)),function(e){console.log("Datos recibidos:",e),function(){var e=document.getElementById("doctype");if(e){C("remove");var t=e.textContent||e.innerText,n=document.getElementById("criteria-title"),o=document.getElementById("own-criteria-title");n?n.textContent=t:console.warn("El elemento con ID 'criteria-title' no existe."),o?o.textContent=t:console.warn("El elemento con ID 'own-criteria-title' no existe.")}else console.warn("El elemento con ID 'doctype' no existe.")}();var t=document.getElementById("qualifier-groups"),n=document.getElementById("qualifier_custom_groups");n.innerHTML="";var o=function(e,t,n){if(e&&0!==e.length&&!e.every((function(e){return!e.associated_criterias||0===e.associated_criterias.length}))){var o=1;e.forEach((function(e){var r=document.createElement("div");r.className="card";var a='\n       <a class="card-header collapsed collapser">\n         <div class="group2">\n           <div class="left-content">\n             <mat-icon class="mat-icon text-xl text-grey-medium material-icons mat-ligature-font mat-icon-no-color icono-izquierda">filter_list</mat-icon>\n             <span class="text-sm !font-semibold text-left bW w-100">'.concat(e.title,'</span>\n           </div>\n           <div class="right-content">\n             <span class="icon icon-chevron-down"></span>\n             <div class="switch-container">\n               <input type="checkbox" id="switch2" class="switch-checkbox" checked />\n               <label for="switch2" class="switch-label">Toggle 2</label>\n             </div>\n             <div class="icon-refresh-revisa"><span class="icon icon-refresh"></span></div>\n           </div>\n         </div>\n       </a>\n     ');r.innerHTML=a;var c=document.createElement("div");c.className="collapse",e.associated_criterias.forEach((function(e,t){var r,a,i="rec-grey",s="icon-minus";"ko"===e.evaluation?(i="rec-red",s="icon-x"):"ok"===e.evaluation&&(i="rec-green",s="icon-check");var l=function(e,t){return{1:"".concat(t,"-green"),2:"".concat(t,"-yellow"),3:"".concat(t,"-orange"),4:"".concat(t,"-red")}[e]||"".concat(t,"-default")},d=l(e.weight,"round-ico"),u=l(e.weight,"badge-bg"),p=l(e.weight,"badge-text"),m={1:"Bajo",2:"Medio",3:"Alto",4:"Muy Alto"}[e.weight]||"",g=e.exclude?'<div class="badge badge-bg-ligth-blue no-select">\n             <span class="badge-text-ligth-blue">Excluyente: Sí</span>\n           </div>':"",f=e.exclude?'<mat-icon _ngcontent-ng-c279190276="" class="mat-icon exclude-icon material-icons">warning</mat-icon>':"",v="".concat(n,"submenu-").concat(t),y=(null===(r=e.normative_refs)||void 0===r||null===(r=r.es)||void 0===r||null===(r=r.refs)||void 0===r?void 0:r.length)||0,h=((null===(a=e.normative_refs)||void 0===a||null===(a=a.es)||void 0===a?void 0:a.refs)||[]).map((function(e){return'\n             <div class="">\n               <div class="alert-norm alert-icon-flex !mt-4 ng-star-inserted">\n                 <span class="norm-margin">\n                   <p class="font-bold">Normativas</p>\n                   <p class="text-xs">'.concat(e.normative_reference,'</p>\n                 </span>\n               </div>\n               <div class="danger-alert alert-icon-flex !mt-4 ng-star-inserted">\n                 <span class="icon icon-danger danger-alert-icon"></span>\n                 <span class="norm-margin">\n                   <p class="font-bold">Incumplimiento</p>\n                   <p class="text-xs">').concat(e.threat,"</p>\n                 </span>\n               </div>\n             </div>\n           ")})).join(""),b="".concat(n,"normativas-btn-").concat(o),x="".concat(n,"exclude-card-").concat(o),E="".concat(n,"-revisa-").concat(o),w='\n         <div class="card">\n           <a class="card-header collapser" data-toggle="collapse" data-target="#'.concat(v,'">\n               <div class="grupo3-box pb-3">\n                   <div class="container-grup3 ms-2">\n                       <span class="rec-box ').concat(i,'">\n                           <span class="icon ').concat(s,'"></span>\n                       </span>\n                       <span class="text-left">\n                       ').concat(e.title,'\n                       </span>\n                   </div>\n                   <div class="right-icons">\n                       ').concat(f,'\n                       <div class="round-ico ').concat(d,'"></div>\n                       <span class="icon icon-chevron-down ms-1"></span>\n                   </div>\n               </div>\n           </a>\n           <div id="').concat(v,'" class="collapse">\n             <div class="card-body sub px-3" data-code="').concat(e.code,'">\n              <div class="integrity-hash" data-code="').concat(e.integrity_hash,'"></div>\n              <div class="exclude-class" data-code="').concat(e.exclude,'"></div>\n               <span class="span-sub-content" data-code="').concat(e.description,'">').concat(e.description,'</span>\n\n               <div class="container-badge">\n                 <div class="badge ').concat(u,' no-select">\n                   <div class="round-ico-badge ').concat(d,'"></div>\n                   <span id="criteria-importance" class="').concat(p,'">Importancia: ').concat(m,'</span>\n                 </div>\n                 <div id="').concat(b,'" class="badge badge-bg-ligth-blue no-select cursor-pointer" onclick="toggleCard(').concat(o,", '").concat(n,'\')">\n                   <span class="badge-text-ligth-blue weight" data-code="').concat(e.weight,'">NORMATIVAS: ').concat(y,"</span>\n                 </div>\n                 ").concat(g,'\n               </div>\n\n                <div id="').concat(x,'" class="hidden">\n                 ').concat(h,'\n                </div>\n               <div>\n                   <div class="container-btn">\n                       <span id="').concat(E,'" class="btn-revisa btn-green no-select no-close cursor-pointer">\n                       <span class="icon icon-refresh icon-white"></span>Revisar</span>\n                       <span class="btn-revisa btn-grey no-select no-close correct">\n                       <span class="icon icon-task-square icon-white"></span>Corregir</span>\n                   </div>\n               </div>\n             </div>\n           </div>\n         </div>\n       ');c.innerHTML+=w,o++})),r.appendChild(c),t.appendChild(r)}))}else t.innerHTML='<div class="generative-qualifier-container h-full">\n  <div class="accordion">\n    <div style="width: 100%; display: flex; justify-content: center;">\n      <div class="info-alert alert-icon-flex my-1 text-xs py-2 !p-2 mx-4 ng-star-inserted">\n        <span class="icon icon-info-circle1 info-alert-icon"></span>\n        <span class="info-alert-text">\n          No se han configurado grupos de criterios para: Tipo de criterio + Tipo\n          de documento + País.\n        </span>\n      </div>\n    </div>\n  </div>\n</div>\n'};o(e.data.qualifier_groups,t,"group"),o(e.data.qualifier_custom_groups,n,"customGroup")}(e)},error:function(e,t,n){var o;console.log("Estado del error: ",t),console.log("Estado del error: ",n),401===e.status?(o=e.responseJSON.message,D()):o="Error del servidor.",console.log({message:o})},complete:function(){}})}function C(e){[{id:"spin-revisa",classes:["icon-refresh-2","w-600","spin-animation"]},{id:"refresh-spin-revisa",classes:["icon-refresh-2","w-800","spin-animation"]},{id:"refresh-spin-revisa-2",classes:["icon-refresh-2","w-800","spin-animation"]},{id:"spin-revisa-1",classes:["icon-refresh-2","w-600","spin-animation"]},{id:"refresh-groups",classes:["spin-animation"]},{id:"refresh-groups-1",classes:["spin-animation"]},{id:"sping-refresh",classes:["spin-animation"]}].forEach((function(o){var r,a,c=o.id,i=o.classes,s=document.getElementById(c);s&&(r=s.classList)[e].apply(r,function(e){if(Array.isArray(e))return n(e)}(a=i)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||t(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}))}function j(){var e=document.getElementById("emailUser").value.trim(),t=document.getElementById("passwordUser").value.trim(),n=document.getElementById("error-message-email"),o=document.getElementById("error-message-password");return n.style.display="none",o.style.display="none",0!==e.length&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?0===t.length?(o.innerText="Por favor, ingrese una contraseña.",void(o.style.display="block")):void function(e,t){U(),q(),$.ajax({url:"https://miadev.miaintelligence.com:444/api/auth/logoutFromOtherSessionsAndLogin",type:"POST",contentType:"application/json",data:JSON.stringify({email:e,password:t,remember_me:!1}),success:function(e){if(R(),e.data&&e.data.original&&e.data.original.message){var t=e.data.original.message,n=document.getElementById("error-message-server");n.innerText=t,n.style.display="block"}else{var o,r=null===(o=e.data)||void 0===o?void 0:o.access_token;if(r)localStorage.setItem("authTokenMia",r),k(),function(){R();var e=document.getElementById("response-token");document.getElementById("response-token").style.display="block",e.innerText="Autenticado con éxito",setTimeout((function(){document.getElementById("auth-token").style.display="none",document.getElementById("bg-color").style.display="none",J()}),2e3)}(),y(),setTimeout((function(){document.getElementById("classify-document").style.display="block"}),2100);else{console.error("Token de acceso no encontrado en la respuesta.");var a=document.getElementById("error-message-server");a.innerText="Error: No se pudo obtener el token de acceso.",a.style.display="block"}}},error:function(e){R(),console.log("Estado del xhr ",e);var t=document.getElementById("error-message-server");t.innerText="Error del servidor.",t.style.display="block"},complete:function(){R()}})}(e,t):(n.innerText="El campo email requiere un formato válido (por ejemplo, xxx@xxx.xxx)",void(n.style.display="block"))}function _(e){var t=document.getElementById("response-text");e&&e.message?t.innerText=e.message:t.innerText="No response from server."}function A(){return localStorage.getItem("authTokenMia")}function P(){localStorage.removeItem("authTokenMia"),document.getElementById("response-delete-token").innerText="Token eliminado",setTimeout((function(){window.location.reload()}),2e3)}function M(){localStorage.removeItem("authTokenMia"),setTimeout((function(){window.location.reload()}),2e3)}function D(){document.getElementById("popup").style.display="flex"}function q(){document.getElementById("loadingMessage").style.display="block"}function J(){document.getElementById("tabs").style.display="block",document.getElementById("tabs-stage").style.display="block"}function H(){document.getElementById("loading-index").style.display="none"}function R(){document.getElementById("loadingMessage").style.display="none"}function G(){document.getElementById("loadingMessageEnv").style.display="none"}function U(){document.getElementById("response-session").style.display="none"}Office.onReady((function(e){var t,n,o;e.host===Office.HostType.Word&&(o=Office.context.contentLanguage,console.log("Idioma actual del documento: ",o),"es-AR"===o?console.log("El idioma es Español"):"en-US"===o?console.log("El idioma es Inglés"):console.log("Idioma no detectado"),document.getElementById("auth-token").style.display="none",document.getElementById("bg-color").style.display="none",document.getElementById("app-body").style.display="flex",document.getElementById("tabs").style.display="none",document.getElementById("tabs-stage").style.display="none",document.getElementById("submitLogin").onclick=j,document.getElementById("eliminar-token").onclick=P,document.getElementById("classify-document-container").onclick=b,document.getElementById("close-document-container").onclick=b,document.getElementById("get-classify-auto").onclick=m,document.getElementById("reload-plugin").onclick=M,document.getElementById("openDialogButton").onclick=s,document.getElementById("openDialogButton2").onclick=i,document.getElementById("get-match-groups").onclick=N,document.getElementById("get-match-groups").onclick=N,document.getElementById("clean-document").onclick=k,document.getElementById("document-forward").addEventListener("click",L),document.getElementById("send-btn").onclick=x,document.getElementById("chat-input").onkeypress=function(e){"Enter"===e.key&&(e.preventDefault(),x())},t=document.querySelectorAll(".tabs-nav li a"),(n=document.querySelectorAll(".tabs-stage > div")).forEach((function(e){return e.style.display="none"})),n[0].style.display="block",t.forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault(),document.querySelector(".tabs-nav li.tab-active").classList.remove("tab-active"),this.parentElement.classList.add("tab-active"),n.forEach((function(e){return e.style.display="none"}));var t=this.getAttribute("href");document.querySelector(t).style.display="block"}))}))),function(){c.apply(this,arguments)}()})),document.addEventListener("click",(function(e){var t=e.target.closest(".btn-revisa.btn-green");if(t){var n=t.id;console.log("ID del botón clicado:",n),function(e){var t,n=null===(t=document.getElementById(e))||void 0===t?void 0:t.closest(".card-body.sub.px-3");if(n){var r,c,i,s;u(e,"add");var l=n.querySelectorAll("p.text-xs");!function(e,t,n){Word.run(function(){var r=a(o().mark((function r(a){var c,i,s;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=a.document,(i=c.body).load("text"),o.next=5,a.sync();case 5:s=i.text.trim()||"Documento vacio",d(e,t,n,s);case 7:case"end":return o.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}(Array.from(l).map((function(e){return e.textContent.trim()})),{dataCode:n.dataset.code,weight:parseInt((null===(r=n.querySelector(".badge-text-ligth-blue.weight"))||void 0===r?void 0:r.dataset.code)||"0",10),integrityHash:(null===(c=n.querySelector(".integrity-hash"))||void 0===c?void 0:c.dataset.code)||null,exclude:"true"===(null===(i=n.querySelector(".exclude-class"))||void 0===i?void 0:i.dataset.code),description:(null===(s=n.querySelector(".span-sub-content"))||void 0===s?void 0:s.dataset.code)||null},e)}else console.log("No se encontró el contenedor para el ID:",e)}(n)}})),document.addEventListener("click",(function(e){var t=e.target.closest(".correct-act");if(t){var n=t.getAttribute("data-code");n&&"[]"!==n?(console.log("lo que le envio:",n),s(n)):s("sin contenido")}}))}(),new URL(n(25803),n.b),new URL(n(58394),n.b)}();
//# sourceMappingURL=taskpane.js.map
