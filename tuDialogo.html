<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diálogo de Office 2</title>
</head>
<body>
  <h2 id="message">Esperando mensaje del complemento...</h2>

  <!-- Asegúrate de cargar Office.js -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <script>
    console.log("Office.js cargado correctamente");

    Office.onReady(function (info) {
      console.log("Office.onReady ejecutado:", info);
      if (info.host === Office.HostType.Word || info.host === Office.HostType.Excel || info.host === Office.HostType.PowerPoint) {
        console.log("Host correcto:", info.host);

        // Añadir handler para recibir mensajes
        Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived, (args) => {
          console.log("Evento DialogParentMessageReceived capturado");

          if (args && args.message) {
            // Actualizar el contenido de la página con el mensaje recibido
            document.getElementById("message").textContent = "Mensaje del complemento: " + args.message;
            console.log("Mensaje recibido en el diálogo:", args.message);
          } else {
            console.warn("Evento recibido, pero sin mensaje:", args);
          }
        }, (result) => {
          if (result.status === Office.AsyncResultStatus.Failed) {
            console.error("Error al añadir handler de mensaje:", result.error.message);
          } else {
            console.log("Handler de mensaje añadido correctamente");
          }
        });
      } else {
        console.warn("Host no compatible:", info.host);
      }
    });

    // Registrar si se pierde el evento
    window.addEventListener("message", (event) => {
      console.log("Mensaje recibido a través de 'message' estándar:", event.data);
    });
  </script>
</body>
</html>

